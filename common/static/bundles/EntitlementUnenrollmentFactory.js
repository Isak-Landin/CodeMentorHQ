(()=>{var e={23844:function(e,t,n){var r,o;(function(i){"use strict";r=[n(95891),n(20428),n(2648)],o=function(e,t,n){var r,o,i,s,l,a,u,c;function d(e){this.text=e}return d.prototype.valueOf=function(){return this.text},d.prototype.toString=function(){return this.text},i=function(t,r){var i=n.interpolate(o(t).toString(),e.mapObject(r,o));return l(i)},s=function(){var e,t="",n=arguments.length;for(e=0;e<n;e+=1)t+=o(arguments[e]);return l(t)},a=function(t,o){return function(i){var s=e.extend({HtmlUtils:r,StringUtils:n},i||{});return l(e.template(t,o)(s))}},u=function(e,n){return t(e).html(o(n).toString())},c=function(e,n){return t(e).prepend(o(n).toString())},r={append:function(e,n){return t(e).append(o(n).toString())},ensureHtml:o=function(t){return t instanceof d?t:l(e.escape(t))},HTML:l=function(e){return new d(e)},HtmlSnippet:d,interpolateHtml:i,joinHtml:s,prepend:c,setHtml:u,template:a}}.apply(t,r),void 0===o||(e.exports=o)}).call(this,n.amdD)},2648:function(e,t,n){var r;(function(n){"use strict";void 0===(r=function(){return{interpolate:function(e,t){return e.replace(/{\w+}/g,(function(e){var n=e.slice(1,-1);return String(t[n])}))}}}.apply(t,[]))||(e.exports=r)}).call(this,n.amdD)},95891:e=>{"use strict";e.exports=window._},20428:e=>{"use strict";e.exports=window.jQuery}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,n),i.exports}n.amdD=function(){throw new Error("define cannot be used indirect")},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};(()=>{"use strict";n.r(r),n.d(r,{EntitlementUnenrollmentFactory:()=>b});const e=window.Backbone;var t=n.n(e),o=n(23844),i=n.n(o),s=n(20428);function l(e){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l(e)}function a(){return a=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a.apply(this,arguments)}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,c(r.key),r)}}function c(e){var t=function(e,t){if("object"!=l(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=l(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==l(t)?t:t+""}function d(e,t,n){return t=h(t),function(e,t){if(t&&("object"===l(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,m()?Reflect.construct(t,n||[],h(e).constructor):t.apply(e,n))}function m(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(m=function(){return!!e})()}function h(e){return h=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},h(e)}function p(e,t){return p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},p(e,t)}const f=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);return d(this,t,[a({},{el:".js-entitlement-unenrollment-modal"},e)])}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&p(e,t)}(t,e),n=t,o=[{key:"redirectTo",value:function(e){window.location.href=e}}],(r=[{key:"initialize",value:function(e){var t=this;this.closeButtonSelector=".js-entitlement-unenrollment-modal .js-entitlement-unenrollment-modal-close-btn",this.headerTextSelector=".js-entitlement-unenrollment-modal .js-entitlement-unenrollment-modal-header-text",this.errorTextSelector=".js-entitlement-unenrollment-modal .js-entitlement-unenrollment-modal-error-text",this.submitButtonSelector=".js-entitlement-unenrollment-modal .js-entitlement-unenrollment-modal-submit",this.triggerSelector=".js-entitlement-action-unenroll",this.mainPageSelector="#dashboard-main",this.genericErrorMsg=gettext("Your unenrollment request could not be processed. Please try again later."),this.modalId="#".concat(this.$el.attr("id")),this.dashboardPath=e.dashboardPath,this.signInPath=e.signInPath,this.browseCourses=e.browseCourses,this.isEdx=e.isEdx,this.$submitButton=s(this.submitButtonSelector),this.$closeButton=s(this.closeButtonSelector),this.$headerText=s(this.headerTextSelector),this.$errorText=s(this.errorTextSelector),this.$submitButton.on("click",this.handleSubmit.bind(this)),s(this.triggerSelector).each((function(){var e=s(this);e.on("click",t.handleTrigger.bind(t)),window.accessible_modal&&window.accessible_modal("#".concat(e.attr("id")),t.closeButtonSelector,"#".concat(t.$el.attr("id")),t.mainPageSelector)}))}},{key:"handleTrigger",value:function(e){var t=s(e.target),n=t.data("courseName"),r=t.data("courseNumber"),o=t.data("entitlementApiEndpoint");this.$previouslyFocusedElement=t,this.resetModal(),this.setHeaderText(n,r),this.setSubmitData(o),this.$el.css("position","fixed")}},{key:"handleSubmit",value:function(){var e=this.$submitButton.data("entitlementApiEndpoint");void 0!==e?(this.$submitButton.prop("disabled",!0),s.ajax({url:e,method:"DELETE",complete:this.onComplete.bind(this)})):this.setError(this.genericErrorMsg)}},{key:"resetModal",value:function(){this.$submitButton.removeData(),this.$submitButton.prop("disabled",!1),this.$headerText.empty(),this.$errorText.removeClass("entitlement-unenrollment-modal-error-text-visible"),this.$errorText.empty()}},{key:"setError",value:function(e){this.$submitButton.prop("disabled",!0),this.$errorText.empty(),i().setHtml(this.$errorText,e),this.$errorText.addClass("entitlement-unenrollment-modal-error-text-visible")}},{key:"setHeaderText",value:function(e,t){this.$headerText.empty(),i().setHtml(this.$headerText,i().interpolateHtml(gettext("Are you sure you want to unenroll from {courseName} ({courseNumber})? You will be refunded the amount you paid."),{courseName:e,courseNumber:t}))}},{key:"setSubmitData",value:function(e){this.$submitButton.removeData(),this.$submitButton.data("entitlementApiEndpoint",e)}},{key:"switchToSlideOne",value:function(){this.$(".entitlement-unenrollment-modal-inner-wrapper header").addClass("hidden"),this.$(".entitlement-unenrollment-modal-submit-wrapper").addClass("hidden"),this.$(".slide1").removeClass("hidden"),this.$(".entitlement-unenrollment-modal-inner-wrapper").prevObject.addClass("entitlement-unenrollment-modal-long-survey"),window.trapFocusForAccessibleModal(this.$previouslyFocusedElement,window.focusableElementsString,this.closeButtonSelector,this.modalId,this.mainPageSelector)}},{key:"switchToSlideTwo",value:function(){var e=this.$(".reasons_survey input[name='priceEntitlementUnenrollment']:checked").val(),t=this.$(".reasons_survey input[name='dissastisfiedEntitlementUnenrollment']:checked").val(),n=this.$(".reasons_survey input[name='difficultEntitlementUnenrollment']:checked").val(),r=this.$(".reasons_survey input[name='timeEntitlementUnenrollment']:checked").val(),o=this.$(".reasons_survey input[name='unavailableEntitlementUnenrollment']:checked").val(),i=this.$(".reasons_survey input[name='emailEntitlementUnenrollment']:checked").val();if(e||t||n||r||o||i){var s={price:e,dissastisfied:t,difficult:n,time:r,unavailable:o,email:i};window.analytics.track("entitlement_unenrollment_reason.selected",{category:"user-engagement",label:JSON.stringify(s),displayName:"v1"})}this.$(".slide1").addClass("hidden"),this.$(".slide2").removeClass("hidden"),this.$(".entitlement-unenrollment-modal-inner-wrapper").prevObject.removeClass("entitlement-unenrollment-modal-long-survey"),window.trapFocusForAccessibleModal(this.$previouslyFocusedElement,window.focusableElementsString,this.closeButtonSelector,this.modalId,this.mainPageSelector)}},{key:"onComplete",value:function(e){var n=e.status,r=e.responseJSON&&e.responseJSON.detail;204===n?this.isEdx?(this.switchToSlideOne(),this.$(".reasons_survey:first .submit-reasons").click(this.switchToSlideTwo.bind(this))):t.redirectTo(this.dashboardPath):401===n&&"Authentication credentials were not provided."===r?t.redirectTo("".concat(this.signInPath,"?next=").concat(encodeURIComponent(this.dashboardPath))):this.setError(this.genericErrorMsg)}}])&&u(n.prototype,r),o&&u(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(t().View);function b(e){return new f(e)}})();var o=window;for(var i in r)o[i]=r[i];r.__esModule&&Object.defineProperty(o,"__esModule",{value:!0})})();